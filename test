-- === FORCE REAL CLICK (MAXIMUM COMPATIBILITY) ===

local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local VIM = game:GetService("VirtualInputManager")

local player = Players.LocalPlayer
local gui = player.PlayerGui

-- PATH
local scrolling = gui
	:WaitForChild("GameGui")
	.Screen.Middle.Trade.Inventory.Inventory
	.Frame.Items.Items.ScrollingFrame

local unit = scrolling:WaitForChild("unit_rafflesia")
local button = unit:FindFirstChildWhichIsA("TextButton", true) or unit

-- 1) บังคับเลื่อนให้ item อยู่ในจอ
pcall(function()
	scrolling.CanvasPosition = Vector2.new(
		0,
		math.max(0, unit.AbsolutePosition.Y - scrolling.AbsolutePosition.Y - 50)
	)
end)

-- 2) บังคับสถานะ GUI
unit.Visible = true
unit.Active = true
if button then
	button.Visible = true
	button.Active = true
	button.ZIndex = 1000
end

-- รอ render เต็ม
task.wait(0.1)
task.wait(0.1)

-- 3) โฟกัสเหมือนเอาเมาส์ชี้
GuiService.SelectedObject = button or unit
task.wait(0.05)

-- 4) คำนวณตำแหน่งกลาง
local target = button or unit
local pos = target.AbsolutePosition + (target.AbsoluteSize / 2)

-- 5) ขยับเมาส์ + คลิกจริง
VIM:SendMouseMoveEvent(pos.X, pos.Y, game)
task.wait(0.03)

VIM:SendMouseButtonEvent(pos.X, pos.Y, 0, true, game, 1)
task.wait(0.06)
VIM:SendMouseButtonEvent(pos.X, pos.Y, 0, false, game, 1)

-- 6) เผื่อเกมฟังคีย์ยืนยัน (บางเกมใช้)
task.wait(0.05)
VIM:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
task.wait(0.05)
VIM:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
