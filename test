-- === FIRE ACCEPT2 FUNCTION (เฉพาะตอนมีตัวเพิ่ม/เปลี่ยน) ===
local function fireAccept2(trade, receiveFrame)
    if not trade or not receiveFrame then
        warn("fireAccept2: trade หรือ receiveFrame ไม่ถูกต้อง")
        return
    end

    local acceptButton2 = trade.Items.Container.Items.Right.Controls.Items.Buttons.Accept
    local lastUnits = {}
    local acceptCooldown = false

    spawn(function()
        while trade and trade.Parent do
            local currentUnits = {}
            for _, frame in ipairs(receiveFrame:GetChildren()) do
                if frame:IsA("Frame") then
                    table.insert(currentUnits, frame.Name)
                end
            end

            -- เฉพาะตอนมียูนิตเพิ่มหรือเปลี่ยนตัว
            local hasChange = false
            if #currentUnits ~= #lastUnits then
                hasChange = true
            else
                for i, name in ipairs(currentUnits) do
                    if name ~= lastUnits[i] then
                        hasChange = true
                        break
                    end
                end
            end

            if hasChange and not acceptCooldown then
                lastUnits = currentUnits
                acceptCooldown = true

                -- Fire Accept2
                local connections = getconnections(acceptButton2.MouseButton1Click)
                if connections and #connections > 0 then
                    pcall(function()
                        connections[1]:Fire()
                        print("[fireAccept2] Accept2 fired! จำนวนยูนิต:", #currentUnits)
                    end)
                end

                -- Cooldown ป้องกัน Fire ซ้ำ
                task.delay(0.8, function()
                    acceptCooldown = false
                end)
            end

            task.wait(0.2)
        end
        print("[fireAccept2] Trade ถูกปิดหรือจบแล้ว")
    end)
end

-- === ตัวอย่างการเรียกใช้งานทันที ===
local middle = game:GetService("Players").LocalPlayer.PlayerGui:WaitForChild("GameGui"):WaitForChild("Screen"):WaitForChild("Middle")
local trade = middle:FindFirstChild("Trade")

if trade and trade.Parent then
    local receiveFrame = trade.Items.Container.Items.Right.Receive.Items.ScrollingFrame
    fireAccept2(trade, receiveFrame)
    print("fireAccept2 เริ่มทำงานแล้ว")
else
    print("ยังไม่มี Trade เปิดอยู่")
end
