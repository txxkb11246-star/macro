-- ===== CONFIG =====
local allowedUsernames = {
    "dusfuxx",
    "skies1R"
}

local receiveUnits = {"unit_rafflesia"} -- {} = รับอะไรก็ได้

-- ===== SERVICES =====
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui"):WaitForChild("GameGui")
local screen = gui:WaitForChild("Screen")
local middle = screen:WaitForChild("Middle")

-- ===== UTILS =====
local function isAllowed(username)
    for _, name in ipairs(allowedUsernames) do
        if name == username then
            return true
        end
    end
    return false
end

local function acceptInvite(username)
    local plr = Players:FindFirstChild(username)
    if plr then
        pcall(function()
            ReplicatedStorage
                :WaitForChild("RemoteFunctions")
                :WaitForChild("TradeAcceptInvite")
                :InvokeServer(plr)
        end)
    end
end

-- ===== AUTO ACCEPT INVITE =====
spawn(function()
    while true do
        for _, plr in ipairs(Players:GetPlayers()) do
            if isAllowed(plr.Name) then
                acceptInvite(plr.Name)
            end
        end
        task.wait(1)
    end
end)

-- ===== WAIT TRADE GUI =====
local trade
repeat
    trade = middle:FindFirstChild("Trade")
    task.wait(0.3)
until trade

-- ===== ACCEPT 1 =====
task.wait(5)
do
    local btn = trade.Terms.Items.Buttons.Items.Accept
    local conns = getconnections(btn.MouseButton1Click)
    if conns and #conns > 0 then
        conns[1]:Fire()
    end
end

-- ===== ACCEPT 2 (SAME LOGIC AS GIVE) =====
spawn(function()
    local receiveFrame = trade.Items.Container.Items.Right.Receive.Items.ScrollingFrame
    local acceptBtn = trade.Items.Container.Items.Right.Controls.Items.Buttons.Accept

    local function hasWantedUnit()
        local foundAny = false
        for _, item in ipairs(receiveFrame:GetChildren()) do
            if item:IsA("Frame") then
                foundAny = true
                if #receiveUnits == 0 then
                    return true
                end
                for _, want in ipairs(receiveUnits) do
                    if item.Name == want then
                        return true
                    end
                end
            end
        end
        return false
    end

    while trade and trade.Parent do
        if hasWantedUnit() and acceptBtn.Visible and acceptBtn.Active then
            local conns = getconnections(acceptBtn.MouseButton1Click)
            if conns and #conns > 0 then
                conns[1]:Fire()
            end
        end
        task.wait(0.4)
    end
end)

-- ===== WAIT END =====
repeat
    trade = middle:FindFirstChild("Trade")
    task.wait(0.2)
until not trade
