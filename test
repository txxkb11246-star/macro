local DEBUG = true
local function dprint(...)
    if DEBUG then print("[DEBUG]", ...) end
end

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

local InventoryFrame = player.PlayerGui
    :WaitForChild("GameGui", true)
    :WaitForChild("Screen", true)
    :WaitForChild("Middle", true)
    :WaitForChild("Inventory", true)
    :WaitForChild("Inventory", true)
    :WaitForChild("Frame", true)
    :WaitForChild("Items", true)
    :WaitForChild("Items", true)
    :WaitForChild("ScrollingFrame", true)

local TradeRemote = ReplicatedStorage
    :WaitForChild("RemoteFunctions")
    :WaitForChild("TradeAddToOffer")

local function extractUniqueIdFromFunction(fn)
    for _, v in pairs(debug.getupvalues(fn)) do
        if type(v) == "string" and v:lower():find("unique") then
            return v
        end
        if type(v) == "table" then
            for _, v2 in pairs(v) do
                if type(v2) == "string" and v2:lower():find("unique") then
                    return v2
                end
            end
        end
    end
end

local function getUniqueIdFromButton(button)
    if not (button:IsA("ImageButton") or button:IsA("TextButton")) then
        return nil
    end
    for _, conn in ipairs(getconnections(button.MouseButton1Click) or {}) do
        if typeof(conn.Function) == "function" then
            local uid = extractUniqueIdFromFunction(conn.Function)
            if uid then return uid end
        end
    end
end

local items = {}
for _, item in ipairs(InventoryFrame:GetChildren()) do
    local uid = getUniqueIdFromButton(item)
    if uid then
        print("[FOUND]", item.Name, uid)
        table.insert(items, uid)
    end
end

for _, uid in ipairs(items) do
    print("[TRADE]", uid)
    TradeRemote:InvokeServer(uid, false)
    task.wait(0.25)
end
