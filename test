-- === SERVICES ===
local Players = game:GetService("Players")
local GuiService = game:GetService("GuiService")
local VIM = game:GetService("VirtualInputManager")
local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui"):WaitForChild("GameGui")
local screen = gui:WaitForChild("Screen")
local middle = screen:WaitForChild("Middle")
local trade = middle:WaitForChild("Trade")

-- === PATH TO SCROLLING FRAME ===
local scrolling = trade.Inventory.Inventory.Frame.Items.Items.ScrollingFrame

-- === 1) หา unit ที่ต้องการ ===
local unitName = "unit_rafflesia" -- เปลี่ยนเป็นชื่อ unit ที่ต้องการ
local unit = scrolling:WaitForChild(unitName)
local button = unit:FindFirstChildWhichIsA("TextButton", true) or unit

-- เลื่อนให้ unit อยู่ในจอ
pcall(function()
    scrolling.CanvasPosition = Vector2.new(
        0,
        math.max(0, unit.AbsolutePosition.Y - scrolling.AbsolutePosition.Y - 50)
    )
end)

-- บังคับสถานะ GUI
unit.Visible = true
unit.Active = true
if button then
    button.Visible = true
    button.Active = true
    button.ZIndex = 1000
end

-- รอให้ GUI render
task.wait(0.2)

-- โฟกัส GUI เหมือนเอาเมาส์ชี้
GuiService.SelectedObject = button or unit
task.wait(0.05)

-- คำนวณตำแหน่งกลาง unit
local pos = (button or unit).AbsolutePosition + ((button or unit).AbsoluteSize / 2)

-- ขยับเมาส์ + คลิก unit จริง
VIM:SendMouseMoveEvent(pos.X, pos.Y, game)
task.wait(0.03)
VIM:SendMouseButtonEvent(pos.X, pos.Y, 0, true, game, 1)
task.wait(0.06)
VIM:SendMouseButtonEvent(pos.X, pos.Y, 0, false, game, 1)

-- กด Enter เผื่อเกมต้อง confirm
task.wait(0.05)
VIM:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
task.wait(0.05)
VIM:SendKeyEvent(false, Enum.KeyCode.Return, false, game)

-- === 2) Fire Add Button ===
local amountAdd = trade:WaitForChild("AmountAdd")
local frame = amountAdd:WaitForChild("Frame"):WaitForChild("Frame")
local addButton = frame.Actions.Items:WaitForChild("Add")

pcall(function()
    local connections = getconnections(addButton.MouseButton1Click)
    for _, conn in pairs(connections) do
        if conn.Function then
            conn:Fire()
            break
        end
    end
end)
