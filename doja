local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local player = game.Players.LocalPlayer

local placedUnits = {}

-- ğŸ§® à¹à¸›à¸¥à¸‡ string à¹€à¸‡à¸´à¸™
local function parseNumber(str)
	str = tostring(str or "")
	local cleaned = str:gsub("[^%d]", "")
	return tonumber(cleaned) or 0
end

-- ğŸ’° à¸£à¸­à¸ˆà¸™à¹€à¸‡à¸´à¸™à¸–à¸¶à¸‡à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢
local function waitUntilCash(target)
	print("ğŸŸ¡ à¸£à¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹€à¸‡à¸´à¸™...")
	local gui = player:WaitForChild("PlayerGui"):WaitForChild("GameGui")
	local cashLabel = gui:WaitForChild("Screen"):WaitForChild("Bottom"):WaitForChild("CurrencyDisplay"):WaitForChild("Cash")

	while true do
		local cashValue = parseNumber(cashLabel.Text)
		print("ğŸ’µ à¹€à¸‡à¸´à¸™à¸•à¸­à¸™à¸™à¸µà¹‰:", cashValue)
		if cashValue >= target then
			print("ğŸ’° à¹€à¸‡à¸´à¸™à¸–à¸¶à¸‡à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢:", target)
			break
		end
		task.wait(1)
	end
end

-- ğŸ•’ à¸£à¸­ unit spawn à¹à¸¥à¸°à¸”à¸¶à¸‡à¸„à¹ˆà¸² Attribute "ID"
local function waitForUnitId(unitName, timeout)
	timeout = timeout or 5
	local startTime = tick()

	while tick() - startTime < timeout do
		local entities = Workspace:WaitForChild("Map"):WaitForChild("Entities")
		for _, unit in pairs(entities:GetChildren()) do
			if unit.Name == unitName and unit:GetAttribute("ID") and not placedUnits[unit:GetAttribute("ID")] then
				local id = unit:GetAttribute("ID")
				placedUnits[id] = unit
				return id
			end
		end
		task.wait(0.1)
	end
	return nil
end

-- ğŸ§± à¸§à¸²à¸‡ unit
local function placeUnit(unitName, position, pathIndex)
	local args = {
		unitName,
		{
			Valid = true,
			PathIndex = pathIndex or 1,
			Position = position,
			DistanceAlongPath = 0,
			CF = CFrame.new(position),
			Rotation = 0
		}
	}

	ReplicatedStorage:WaitForChild("RemoteFunctions"):WaitForChild("PlaceUnit"):InvokeServer(unpack(args))

	local id = waitForUnitId(unitName, 5)
	if id then
		print("âœ… à¸§à¸²à¸‡ unit:", unitName, "ID:", id)
	else
		warn("âŒ à¹„à¸¡à¹ˆà¸à¸š ID à¸‚à¸­à¸‡", unitName)
	end
	return id
end

-- â¬†ï¸ à¸­à¸±à¸›à¹€à¸à¸£à¸” unit
local function upgradeUnitById(id)
	if placedUnits[id] then
		local args = { id }
		ReplicatedStorage:WaitForChild("RemoteFunctions"):WaitForChild("UpgradeUnit"):InvokeServer(unpack(args))
		print("ğŸ”¼ à¸­à¸±à¸›à¹€à¸à¸£à¸” unit ID:", id)
	else
		print("âŒ à¹„à¸¡à¹ˆà¸à¸š unit ID:", id)
	end
end

local id1 = placeUnit("unit_rafflesia", Vector3.new(52.80524826049805, -21.75, -55.88352966308594), 1)
task.wait(12)
local id2 = placeUnit("unit_rafflesia", Vector3.new(-51.1591796875, -21.75, -49.975502014160156), 2)
task.wait(54)
local id3 = placeUnit("unit_rafflesia", Vector3.new(52.678672790527344, -21.75, -55.75695037841797), 3)
waitUntilCash(8000)
upgradeUnitById(id3)
