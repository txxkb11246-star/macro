local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local player = game.Players.LocalPlayer

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö unit ‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß {id = unitInstance}
local placedUnitIds = {}

-- ‡πÅ‡∏õ‡∏•‡∏á string ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÄ‡∏ä‡πà‡∏ô "$14,635" ‚Üí 14635
local function parseNumber(str)
    str = tostring(str or "")
    local cleaned = str:gsub("[^%d]", "")
    return tonumber(cleaned) or 0
end

-- ‡∏£‡∏≠‡∏à‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
local function waitUntilCash(target)
    print("üü° ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏¥‡∏ô...")
    local gui = player:WaitForChild("PlayerGui"):WaitForChild("GameGui")
    local cashLabel = gui:WaitForChild("Screen"):WaitForChild("Bottom"):WaitForChild("CurrencyDisplay"):WaitForChild("Cash")

    while true do
        local cashValue = parseNumber(cashLabel.Text)
        print("üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:", cashValue)
        if cashValue >= target then
            print("üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:", target)
            break
        end
        task.wait(1)
    end
end

-- ‡∏ß‡∏≤‡∏á unit ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö id
local function placeUnit(unitName, position, pathIndex)
    local args = {
        unitName,
        {
            Valid = true,
            PathIndex = pathIndex or 1,
            Position = position,
            DistanceAlongPath = 0,
            CF = CFrame.new(position),
            Rotation = 0
        }
    }

    -- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å server ‡∏ß‡∏≤‡∏á unit
    ReplicatedStorage:WaitForChild("RemoteFunctions"):WaitForChild("PlaceUnit"):InvokeServer(unpack(args))
    
    -- ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÉ‡∏´‡πâ unit spawn ‡πÉ‡∏ô Workspace
    task.wait(0.5)

    -- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö unit ‡∏ó‡∏µ‡πà spawn ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô Workspace.Map.Entities
    local entitiesFolder = Workspace:WaitForChild("Map"):WaitForChild("Entities")
    for _, unit in pairs(entitiesFolder:GetChildren()) do
        if unit.Name == unitName and not placedUnitIds[unit:GetAttribute("id")] then
            local id = unit:GetAttribute("id")
            if id then
                placedUnitIds[id] = unit
                print("‚úÖ ‡∏ß‡∏≤‡∏á unit:", unitName, "ID:", id)
                return id -- ‡∏™‡πà‡∏á id ‡∏Ç‡∏≠‡∏á unit ‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÑ‡∏õ
            end
        end
    end
end

-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î unit ‡∏ï‡∏≤‡∏° id
local function upgradeUnitById(id)
    if placedUnitIds[id] then
        local args = {id}
        ReplicatedStorage:WaitForChild("RemoteFunctions"):WaitForChild("UpgradeUnit"):InvokeServer(unpack(args))
        print("üîº ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î unit ID:", id)
    else
        print("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö unit ID:", id)
    end
end

-- === ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ===
waitUntilCash(8000)

-- ‡∏ß‡∏≤‡∏á‡∏´‡∏•‡∏≤‡∏¢ unit ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö id ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß
local id1 = placeUnit("unit_rafflesia", Vector3.new(47.6, -21.75, -50.68), 1)
local id2 = placeUnit("unit_lawnmower", Vector3.new(50, -21.75, -48), 2)
local id3 = placeUnit("unit_tower", Vector3.new(52, -21.75, -46), 1)

-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ unit ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
upgradeUnitById(id1) -- ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å
-- upgradeUnitById(id2) -- ‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
